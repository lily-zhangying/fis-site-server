<!--
title: 配置API
toc: <ul class="nav"><li><a href="#toc_0">零配置</a></li><li><a href="#toc_1">使用配置文件</a><ul class="nav"><li><a href="#toc_2">内置的默认配置</a></li><li><a href="#toc_3">project.charset</a></li><li><a href="#toc_4">project.md5Length</a></li><li><a href="#toc_5">project.md5Connector</a></li><li><a href="#toc_6">project.include</a></li><li><a href="#toc_7">project.exclude</a></li><li><a href="#toc_8">project.fileType.text</a></li><li><a href="#toc_9">project.fileType.image</a></li></ul></li><li><a href="#toc_10">插件配置</a><ul class="nav"><li><a href="#toc_11">modules.parser</a></li><li><a href="#toc_12">modules.preprocessor</a></li><li><a href="#toc_13">modules.postprocessor</a></li><li><a href="#toc_14">modules.lint</a></li><li><a href="#toc_15">modules.test</a></li><li><a href="#toc_16">modules.optimizer</a></li><li><a href="#toc_17">modules.prepackager</a></li><li><a href="#toc_18">modules.packager</a></li><li><a href="#toc_19">modules.spriter</a></li><li><a href="#toc_20">modules.postpackager</a></li><li><a href="#toc_21">settings</a></li></ul></li><li><a href="#toc_22">内置插件运行配置</a><ul class="nav"><li><a href="#toc_23">settings.postprocessor.jswrapper</a></li><li><a href="#toc_24">settings.optimizer.uglify-js</a></li><li><a href="#toc_25">settings.optimizer.clean-css</a></li><li><a href="#toc_26">settings.optimizer.png-compressor</a></li><li><a href="#toc_27">settings.spriter.csssprites</a></li></ul></li><li><a href="#toc_28">目录规范与域名配置</a><ul class="nav"><li><a href="#toc_29">roadmap.path</a></li><li><a href="#toc_30">roadmap.ext</a></li><li><a href="#toc_31">roadmap.domain</a></li><li><a href="#toc_32">roadmap.domain.image</a></li></ul></li><li><a href="#toc_33">部署配置</a><ul class="nav"><li><a href="#toc_34">deploy</a></li></ul></li><li><a href="#toc_35">打包配置</a><ul class="nav"><li><a href="#toc_36">pack</a></li></ul></li></ul>
-->

<blockquote>
<p>F.I.S可以支持从最简单的前端开发到大规模大团队项目开发，因此允许用户以 <strong>零配置</strong> 开始使用F.I.S，于此同时经过适当配置和扩展，F.I.S还能展现其强大的开发支持能力，足以应对大型商业产品开发需求。</p>
</blockquote>

<h2 id="toc_0">零配置</h2>

<p>不使用任何配置，fis将支持：</p>

<ol>
<li>使用 <strong>fis install &lt;name&gt;</strong> 命令安装fis仓库提供的各种 <strong>组件、框架、示例、素材、配置等</strong> 开发资源。</li>
<li>使用 <strong>fis server start</strong> 命令启动一个本地调试服务器，完美支持php后端程序</li>
<li>使用 <strong>fis release --dest ./output --md5</strong> 命令为所有静态资源文件（js、css、图片、flash等）添加md5戳，并修改文件中的引用路径</li>
<li>使用 <strong>fis release --dest ./output --optimize</strong> 命令对js、css、html、htm文件进行压缩（后续还会加上对图片的自动压缩）</li>
<li>编译中对 <strong>js</strong>、 <strong>css</strong> 以及 <strong>类html</strong> ( <em>html, htm, xhtml, tpl, php, jsp, asp</em> ) 文件分别支持三种扩展语言能力：

<ul>
<li><strong>资源定位</strong>：获取任何开发中所使用资源的线上路径；</li>
<li><strong>内容嵌入</strong>：把一个文件的内容(文本)或者base64编码(图片)嵌入到另一个文件中；</li>
<li><strong>依赖声明</strong>：在一个文本文件内标记对其他文件的依赖关系；</li>
</ul></li>
</ol>

<p>以上功能可满足传统前端开发所需的基本要求</p>

<h2 id="toc_1">使用配置文件</h2>

<p>在项目目录下新建一个 <strong>fis-conf.js</strong> 文件，我们可以对fis的编译系统做各种定制化配置。配置fis系统的接口是：</p>
<div class="highlight"><pre><span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
</pre></div>
<p>或者</p>
<div class="highlight"><pre><span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">merge</span><span class="p">({...});</span>
</pre></div>
<p>由于fis自动化工具采用nodejs作为平台，因此其配置文件也是js书写的。fis变量是全局注册，config属性是fis系统的配置对象实例，merge或set方法用以合并配置数据。</p>

<h3 id="toc_2">内置的默认配置</h3>

<p>由于fis系统是完全插件化的，因此fis.config对象会有一些内置配置用以为用户提供零配置下的基本功能，所以配置文件中使用<code>fis.config.merge</code> 或者 <code>fis.config.set</code> 接口来追加用户配置。而内部初始化的配置数是：</p>
<div class="highlight"><pre><span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">init</span><span class="p">({</span>
    <span class="nx">project</span> <span class="o">:</span> <span class="p">{</span>
        <span class="nx">charset</span> <span class="o">:</span> <span class="s1">&#39;utf8&#39;</span><span class="p">,</span>
        <span class="nx">md5Length</span> <span class="o">:</span> <span class="mi">7</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>
<h3 id="toc_3">project.charset</h3>

<ul>
<li>解释：指定项目编译后产出文件的编码。</li>
<li>值类型：<code>string</code></li>
<li>默认值：&#39;utf8&#39;</li>
<li>用法：在项目的fis-conf.js里可以覆盖为</li>
</ul>
<div class="highlight"><pre><span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;project.charset&#39;</span><span class="p">,</span> <span class="s1">&#39;gbk&#39;</span><span class="p">);</span>
</pre></div>
<p>或者</p>
<div class="highlight"><pre><span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">merge</span><span class="p">({</span>
    <span class="nx">project</span> <span class="o">:</span> <span class="p">{</span> <span class="nx">charset</span> <span class="o">:</span> <span class="s1">&#39;gbk&#39;</span> <span class="p">}</span>
<span class="p">});</span>
</pre></div>
<h3 id="toc_4">project.md5Length</h3>

<ul>
<li>解释：文件MD5戳长度。</li>
<li>值类型：<code>number</code></li>
<li>默认值：7</li>
<li>用法：在项目的fis-conf.js里可以修改为</li>
</ul>
<div class="highlight"><pre><span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;project.md5Length&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
</pre></div>
<p>或者</p>
<div class="highlight"><pre><span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">merge</span><span class="p">({</span>
    <span class="nx">project</span> <span class="o">:</span> <span class="p">{</span> <span class="nx">md5Length</span> <span class="o">:</span> <span class="mi">8</span> <span class="p">}</span>
<span class="p">});</span>
</pre></div>
<h3 id="toc_5">project.md5Connector</h3>

<ul>
<li>解释：设置md5与文件的连字符。</li>
<li>值类型：<code>string</code></li>
<li>默认值：&#39;_&#39;</li>
<li>用法：在项目的fis-conf.js里可以修改为</li>
</ul>
<div class="highlight"><pre><span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;project.md5Connector &#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">);</span>
</pre></div>
<p>或者</p>
<div class="highlight"><pre><span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">merge</span><span class="p">({</span>
    <span class="nx">project</span> <span class="o">:</span> <span class="p">{</span> <span class="nx">md5Connector</span> <span class="o">:</span> <span class="s1">&#39;.&#39;</span> <span class="p">}</span>
<span class="p">});</span>
</pre></div>
<h3 id="toc_6">project.include</h3>

<ul>
<li>解释：设置项目源码文件include过滤器。只有命中include的文件才被视为源码，其他文件则忽略。</li>
<li>值类型：<code>string</code> | <code>RegExp</code></li>
<li>默认值：无</li>
<li>用法：在项目的fis-conf.js里可以修改为</li>
</ul>
<div class="highlight"><pre><span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;project.include&#39;</span><span class="p">,</span> <span class="s1">&#39;src/**&#39;</span><span class="p">);</span>
</pre></div>
<p>或者</p>
<div class="highlight"><pre><span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">merge</span><span class="p">({</span>
    <span class="nx">project</span> <span class="o">:</span> <span class="p">{</span> <span class="nx">include</span> <span class="o">:</span> <span class="s1">&#39;src/**&#39;</span> <span class="p">}</span>
<span class="p">});</span>
</pre></div>
<h3 id="toc_7">project.exclude</h3>

<ul>
<li>解释：设置项目源码文件exclude过滤器。如果同时设置了 <a href="https://github.com/fis-dev/fis/wiki/%E9%85%8D%E7%BD%AEAPI#projectinclude">project.include</a> 和 <code>project.exclude</code> 则表示在include所命中的文件中排除掉某些文件。</li>
<li>值类型：<code>string</code> | <code>RegExp</code></li>
<li>默认值：无</li>
<li>用法：在项目的fis-conf.js里可以修改为</li>
</ul>
<div class="highlight"><pre><span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;project.exclude&#39;</span><span class="p">,</span> <span class="sr">/^\/_build\//i</span><span class="p">);</span>
</pre></div>
<p>或者</p>
<div class="highlight"><pre><span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">merge</span><span class="p">({</span>
    <span class="nx">project</span> <span class="o">:</span> <span class="p">{</span> <span class="nx">exclude</span> <span class="o">:</span> <span class="sr">/^\/_build\//i</span> <span class="p">}</span>
<span class="p">});</span>
</pre></div>
<h3 id="toc_8">project.fileType.text</h3>

<ul>
<li>解释：追加文本文件后缀列表。</li>
<li>值类型：<code>Array</code> | <code>string</code></li>
<li>默认值：无</li>
<li>说明：fis系统在编译时会对文本文件和图片类二进制文件做不同的处理，文件分类依据是后缀名。虽然内部已列出一些常见的文本文件后缀，但难保用户有其他的后缀文件，内部已列入文本文件后缀的列表为： [ <strong>&#39;css&#39;, &#39;tpl&#39;, &#39;js&#39;, &#39;php&#39;, &#39;txt&#39;, &#39;json&#39;, &#39;xml&#39;, &#39;htm&#39;, &#39;text&#39;, &#39;xhtml&#39;, &#39;html&#39;, &#39;md&#39;, &#39;conf&#39;, &#39;po&#39;, &#39;config&#39;, &#39;tmpl&#39;, &#39;coffee&#39;, &#39;less&#39;, &#39;sass&#39;, &#39;jsp&#39;, &#39;scss&#39;, &#39;manifest&#39;, &#39;bak&#39;, &#39;asp&#39;, &#39;tmp&#39;</strong> ]，用户配置会 <strong>追加</strong>，而非覆盖内部后缀列表。</li>
<li>用法：编辑项目的fis-conf.js配置文件</li>
</ul>
<div class="highlight"><pre><span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;project.fileType.text&#39;</span><span class="p">,</span> <span class="s1">&#39;tpl, js, css&#39;</span><span class="p">);</span>
</pre></div>
<p>或者</p>
<div class="highlight"><pre><span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">merge</span><span class="p">({</span>
    <span class="nx">project</span> <span class="o">:</span> <span class="p">{</span>
        <span class="nx">fileType</span> <span class="o">:</span> <span class="p">{</span>
            <span class="nx">text</span> <span class="o">:</span> <span class="s1">&#39;tpl, js, css&#39;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>
<h3 id="toc_9">project.fileType.image</h3>

<ul>
<li>解释：追加图片类二进制文件后缀列表。</li>
<li>值类型：<code>Array</code> | <code>string</code></li>
<li>默认值：无</li>
<li>说明：fis系统在编译时会对文本文件和图片类二进制文件做不同的处理，文件分类依据是后缀名。虽然内部已列出一些常见的图片类二进制文件后缀，但难保用户有其他的后缀文件，内部已列入文本文件后缀的列表为： [ <strong>&#39;svg&#39;, &#39;tif&#39;, &#39;tiff&#39;, &#39;wbmp&#39;, &#39;png&#39;, &#39;bmp&#39;, &#39;fax&#39;, &#39;gif&#39;, &#39;ico&#39;, &#39;jfif&#39;, &#39;jpe&#39;, &#39;jpeg&#39;, &#39;jpg&#39;, &#39;woff&#39;, &#39;cur&#39;</strong> ]，用户配置会 <strong>追加</strong>，而非覆盖内部后缀列表。</li>
<li>用法：编辑项目的fis-conf.js配置文件</li>
</ul>
<div class="highlight"><pre><span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;project.fileType.image&#39;</span><span class="p">,</span> <span class="s1">&#39;swf, cur, ico&#39;</span><span class="p">);</span>
</pre></div>
<p>或者</p>
<div class="highlight"><pre><span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">merge</span><span class="p">({</span>
    <span class="nx">project</span> <span class="o">:</span> <span class="p">{</span>
        <span class="nx">fileType</span> <span class="o">:</span> <span class="p">{</span>
            <span class="nx">image</span> <span class="o">:</span> <span class="s1">&#39;swf, cur, ico&#39;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>
<h2 id="toc_10">插件配置</h2>

<blockquote>
<p>fis系统有非常灵活的插件扩展能力，详细内容请参看 <a href="https://github.com/fis-dev/fis/wiki/%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86">运行原理</a>，<a href="https://github.com/fis-dev/fis/wiki/%E6%8F%92%E4%BB%B6%E8%B0%83%E7%94%A8%E6%9C%BA%E5%88%B6">插件调用机制</a>，<a href="https://github.com/fis-dev/fis/wiki/%E6%8F%92%E4%BB%B6%E6%89%A9%E5%B1%95%E7%82%B9%E5%88%97%E8%A1%A8">插件扩展点列表</a>等文档。</p>

<p>fis所有的插件配置都支持定义一个 <strong>数组或者逗号分隔的字符串序列</strong> 来依次处理文件内容。</p>
</blockquote>

<h3 id="toc_11">modules.parser</h3>

<ul>
<li>解释：配置编译器插件，可以根据 <strong>文件后缀</strong> 将某种语言编译成标准的js、css、html语言。</li>
<li>值类型：<code>Object</code></li>
<li>默认值：无</li>
<li>说明：fis对文件进行编译时，首先进入的是parser阶段，该阶段的定义是： <strong>将非标准语言编译成标准的html、js、css语言</strong>。例如我们可以利用这个阶段的处理把coffee、前端模板文件编译成js，less、sass、compass编译成css。在该阶段配置的插件，实际调用的是 <strong>fis-parser-xxx</strong>，这是fis <a href="https://github.com/fis-dev/fis/wiki/%E6%8F%92%E4%BB%B6%E6%89%A9%E5%B1%95%E7%82%B9%E5%88%97%E8%A1%A8#parser">parser插件命名规范</a> 所约束的。parser插件通常不会内置，如需要相关插件，可以使用npm安装，具体说明请参考文档 <a href="https://github.com/fis-dev/fis/wiki/%E6%8F%92%E4%BB%B6%E8%B0%83%E7%94%A8%E6%9C%BA%E5%88%B6">插件调用机制</a>。由于parser的主要职责是统一标准语言，因此它经常会和 <strong>roadmap.ext</strong> 配置配合使用，用于标记某个后缀的文件在parser阶段之后当做某种标准语言进行处理。</li>
<li>用法：</li>
</ul>
<div class="highlight"><pre><span class="c1">//fis-conf.js</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">merge</span><span class="p">({</span>
    <span class="nx">modules</span> <span class="o">:</span> <span class="p">{</span>
        <span class="nx">parser</span> <span class="o">:</span> <span class="p">{</span>
            <span class="c1">//coffee后缀的文件使用fis-parser-coffee-script插件编译</span>
            <span class="nx">coffee</span> <span class="o">:</span> <span class="s1">&#39;coffee-script&#39;</span><span class="p">,</span>
            <span class="c1">//less后缀的文件使用fis-parser-less插件编译</span>
            <span class="c1">//处理器支持数组，或者逗号分隔的字符串配置</span>
            <span class="nx">less</span> <span class="o">:</span> <span class="p">[</span><span class="s1">&#39;less&#39;</span><span class="p">],</span>
            <span class="c1">//md后缀的文件使用fis-parser-marked插件编译</span>
            <span class="nx">md</span> <span class="o">:</span> <span class="s1">&#39;marked&#39;</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">roadmap</span> <span class="o">:</span> <span class="p">{</span>
        <span class="nx">ext</span> <span class="o">:</span> <span class="p">{</span>
            <span class="c1">//less后缀的文件将输出为css后缀</span>
            <span class="c1">//并且在parser之后的其他处理流程中被当做css文件处理</span>
            <span class="nx">less</span> <span class="o">:</span> <span class="s1">&#39;css&#39;</span><span class="p">,</span>
            <span class="c1">//coffee后缀的文件将输出为js文件</span>
            <span class="c1">//并且在parser之后的其他处理流程中被当做js文件处理</span>
            <span class="nx">coffee</span> <span class="o">:</span> <span class="s1">&#39;js&#39;</span><span class="p">,</span>
            <span class="c1">//md后缀的文件将输出为html文件</span>
            <span class="c1">//并且在parser之后的其他处理流程中被当做html文件处理</span>
            <span class="nx">md</span> <span class="o">:</span> <span class="s1">&#39;html&#39;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>
<h3 id="toc_12">modules.preprocessor</h3>

<ul>
<li>解释：配置 标准化预处理器插件，可以根据 <strong>文件后缀</strong> 对文件进行预处理。</li>
<li>值类型：<code>Object</code></li>
<li>默认值：无</li>
<li>说明：标准化预处理的下一个阶段就是标准化处理阶段，标准化处理阶段主要责任是 <a href="https://github.com/fis-dev/fis/wiki/%E4%B8%89%E7%A7%8D%E8%AF%AD%E8%A8%80%E8%83%BD%E5%8A%9B">扩展三种语言能力</a>，因此preprocessor插件可以在标准化处理之前对内容进行某些修改，比如 <a href="https://github.com/fouber/fis-preprocessor-image-set">fis-preprocessor-image-set</a> 插件，用于实现对retina屏的css的image-set属性支持。</li>
<li>用法：</li>
</ul>
<div class="highlight"><pre><span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;modules.preprocessor.css&#39;</span><span class="p">,</span> <span class="s1">&#39;image-set&#39;</span><span class="p">);</span>
</pre></div><div class="highlight"><pre><span class="err">或者</span>
</pre></div><div class="highlight"><pre><span class="c1">//fis-conf.js</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">merge</span><span class="p">({</span>
    <span class="nx">modules</span> <span class="o">:</span> <span class="p">{</span>
        <span class="nx">preprocessor</span> <span class="o">:</span> <span class="p">{</span>
            <span class="c1">//css后缀文件会经过fis-preprocessor-image-set插件的预处理</span>
            <span class="nx">css</span> <span class="o">:</span> <span class="s1">&#39;image-set&#39;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>
<h3 id="toc_13">modules.postprocessor</h3>

<ul>
<li>解释：在fis对js、css和类html文件进行语言能力扩展之后调用的插件配置，可以根据 <strong>文件后缀</strong> 对文件进行后处理。该阶段的插件可以获取文件对象的完整requires信息。</li>
<li>值类型：<code>Object</code></li>
<li>默认值：</li>
</ul>
<div class="highlight"><pre><span class="p">{</span> <span class="nx">js</span> <span class="o">:</span> <span class="s1">&#39;jswrapper&#39;</span> <span class="p">}</span>
</pre></div>
<ul>
<li>说明：标准化处理之后，fis已经完成了对前端领域语言的 <a href="https://github.com/fis-dev/fis/wiki/%E4%B8%89%E7%A7%8D%E8%AF%AD%E8%A8%80%E8%83%BD%E5%8A%9B">三种语言能力</a> 扩展，此时文件对象的相关信息已经获取到了，这个阶段我们可以对文件进行一些相关处理，比如amd包装等。fis内置的 <a href="https://github.com/fis-dev/fis-postprocessor-jswrapper">fis-postprocessor- jswrapper</a> 插件就是在这个阶段对js进行包装的。</li>
<li>用法：类似 <a href="https://github.com/fis-dev/fis/wiki/%E9%85%8D%E7%BD%AEAPI#modulespreprocessor">modules.preprocessor</a></li>
</ul>

<h3 id="toc_14">modules.lint</h3>

<ul>
<li>解释：单文件编译过程中的代码检查插件。</li>
<li>值类型：<code>Object</code></li>
<li>默认值：无</li>
<li>说明：fis支持在文件进行编译的过程中进行代码检查，这类插件 <strong>不会对文件内容做任何修改</strong>。fis模块内置没有安装任何校验插件，用户如果需要，可以自行开发，并发布到npm上。</li>
<li>用法：</li>
</ul>
<div class="highlight"><pre><span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;modules.lint.js&#39;</span><span class="p">,</span> <span class="s1">&#39;jshint&#39;</span><span class="p">);</span>
</pre></div><div class="highlight"><pre><span class="err">或者</span>
</pre></div><div class="highlight"><pre><span class="c1">//fis-conf.js</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">merge</span><span class="p">({</span>
    <span class="nx">modules</span> <span class="o">:</span> <span class="p">{</span>
        <span class="nx">lint</span> <span class="o">:</span> <span class="p">{</span>
            <span class="c1">//js后缀文件会经过fis-lint-jshint插件的代码校验检查</span>
            <span class="nx">js</span> <span class="o">:</span> <span class="s1">&#39;jshint&#39;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>
<h3 id="toc_15">modules.test</h3>

<ul>
<li>解释：单文件编译过程中的自动测试插件。</li>
<li>值类型：<code>Object</code></li>
<li>默认值：无</li>
<li>说明：fis支持在文件进行编译的过程中进行自动化测试，这类插件 <strong>不会对文件内容做任何修改</strong>。fis模块没有内置任何测试插件，用户如果需要，可以自行开发，并发布到npm上。</li>
<li>用法：</li>
</ul>
<div class="highlight"><pre><span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;modules.test.js&#39;</span><span class="p">,</span> <span class="s1">&#39;phantomjs&#39;</span><span class="p">);</span>
</pre></div><div class="highlight"><pre><span class="err">或者</span>
</pre></div><div class="highlight"><pre><span class="c1">//fis-conf.js</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">merge</span><span class="p">({</span>
    <span class="nx">modules</span> <span class="o">:</span> <span class="p">{</span>
        <span class="nx">test</span> <span class="o">:</span> <span class="p">{</span>
            <span class="c1">//js后缀文件会经过fis-test-phantomjs插件的测试</span>
            <span class="nx">js</span> <span class="o">:</span> <span class="s1">&#39;phantomjs&#39;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>
<h3 id="toc_16">modules.optimizer</h3>

<ul>
<li>解释：单文件编译过程中的最后阶段，对文件进行优化。</li>
<li>值类型：<code>Object</code></li>
<li>默认值：</li>
</ul>
<div class="highlight"><pre><span class="p">{</span>
    <span class="nx">js</span> <span class="o">:</span> <span class="s1">&#39;uglify-js&#39;</span><span class="p">,</span>
    <span class="nx">css</span> <span class="o">:</span> <span class="s1">&#39;clean-css&#39;</span><span class="p">,</span>
    <span class="nx">png</span> <span class="o">:</span> <span class="s1">&#39;png-compressor&#39;</span>
<span class="p">}</span>   
</pre></div>
<ul>
<li>说明：单文件编译的最后阶段，可以对代码进行优化，通常是压缩、xss修复等工作，fis内置了3个压缩插件： <a href="https://github.com/fis-dev/fis-optimizer-uglify-js">fis-optimizer-uglify-js</a>、<a href="https://github.com/fis-dev/fis-optimizer-clean-css">fis-optimizer-clean-css</a>、<a href="https://github.com/fis-dev/fis-optimizer-html-minifier">fis-optimizer-html-minifier</a>。</li>
<li>用法：</li>
</ul>
<div class="highlight"><pre><span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;modules.optimizer.js&#39;</span><span class="p">,</span> <span class="s1">&#39;uglify-js&#39;</span><span class="p">);</span>
</pre></div><div class="highlight"><pre><span class="err">或者</span>
</pre></div><div class="highlight"><pre><span class="c1">//fis-conf.js</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">merge</span><span class="p">({</span>
    <span class="nx">modules</span> <span class="o">:</span> <span class="p">{</span>
        <span class="nx">optimizer</span> <span class="o">:</span> <span class="p">{</span>
            <span class="c1">//js后缀文件会经过fis-optimizer-uglify-js插件的压缩优化</span>
            <span class="nx">js</span> <span class="o">:</span> <span class="s1">&#39;uglify-js&#39;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>
<h3 id="toc_17">modules.prepackager</h3>

<ul>
<li>解释：打包预处理插件。</li>
<li>值类型：<code>Array</code> | <code>string</code></li>
<li>默认值：无</li>
<li>说明：在fis打包操作前调用的插件， <strong>不管调用fis release命令时是否使用 --pack 参数，该插件均会被调用</strong>。</li>
<li>用法：</li>
</ul>
<div class="highlight"><pre><span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;modules.prepackager&#39;</span><span class="p">,</span> <span class="s1">&#39;oo, xx&#39;</span><span class="p">);</span>
</pre></div><div class="highlight"><pre><span class="err">或者</span>
</pre></div><div class="highlight"><pre><span class="c1">//fis-conf.js</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">merge</span><span class="p">({</span>
    <span class="nx">modules</span> <span class="o">:</span> <span class="p">{</span>
        <span class="c1">//打包前调用fis-prepackager-oo和fis-prepackager-xx插件进行处理</span>
        <span class="nx">prepackager</span> <span class="o">:</span> <span class="s1">&#39;oo, xx&#39;</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>
<h3 id="toc_18">modules.packager</h3>

<ul>
<li>解释：打包处理插件。</li>
<li>值类型：<code>Array</code> | <code>string</code></li>
<li>默认值：&#39;map&#39;, fis内置了打包插件 <code>fis-packager-map</code>，生成 <strong>map.json</strong> 文件</li>
<li>说明：调用fis release命令时，添加 <strong>--pack</strong> 参数，该插件才会被调用。</li>
<li>用法：</li>
</ul>
<div class="highlight"><pre><span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;modules.packager&#39;</span><span class="p">,</span> <span class="s1">&#39;your_packager&#39;</span><span class="p">);</span>
</pre></div><div class="highlight"><pre><span class="err">或者</span>
</pre></div><div class="highlight"><pre><span class="c1">//fis-conf.js</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">merge</span><span class="p">({</span>
    <span class="nx">modules</span> <span class="o">:</span> <span class="p">{</span>
        <span class="c1">//打包调用fis-packager-your_packager插件进行处理</span>
        <span class="nx">packager</span> <span class="o">:</span> <span class="s1">&#39;your_packager&#39;</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>
<h3 id="toc_19">modules.spriter</h3>

<ul>
<li>解释：打包后处理csssprite的插件。</li>
<li>值类型：<code>Array</code> | <code>string</code></li>
<li>默认值：&#39;csssprites&#39;，fis内置了spriter插件 <code>fis-spriter-csssprites</code>，支持自动css打包</li>
<li>说明：调用fis release命令时，添加 <strong>--pack</strong> 参数，该插件才会被调用。</li>
<li>用法：</li>
</ul>
<div class="highlight"><pre><span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;modules.spriter&#39;</span><span class="p">,</span> <span class="s1">&#39;your_spriter&#39;</span><span class="p">);</span>
</pre></div><div class="highlight"><pre><span class="err">或者</span>
</pre></div><div class="highlight"><pre><span class="c1">//fis-conf.js</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">merge</span><span class="p">({</span>
    <span class="nx">modules</span> <span class="o">:</span> <span class="p">{</span>
        <span class="c1">//打包后调用fis-spriter-your_spriter插件进行css sprites化处理</span>
        <span class="nx">spriter</span> <span class="o">:</span> <span class="s1">&#39;your_spriter&#39;</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>
<h3 id="toc_20">modules.postpackager</h3>

<ul>
<li>解释：打包后处理插件。</li>
<li>值类型：<code>Array</code> | <code>string</code></li>
<li>默认值：无</li>
<li>说明：在fis打包操作后调用的插件， <strong>不管调用fis release命令时是否使用 --pack 参数，该插件均会被调用</strong>。</li>
<li>用法：</li>
</ul>
<div class="highlight"><pre><span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;modules.postpackager&#39;</span><span class="p">,</span> <span class="s1">&#39;your_postpackager&#39;</span><span class="p">);</span>
</pre></div><div class="highlight"><pre><span class="err">或者</span>
</pre></div><div class="highlight"><pre><span class="c1">//fis-conf.js</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">merge</span><span class="p">({</span>
    <span class="nx">modules</span> <span class="o">:</span> <span class="p">{</span>
        <span class="c1">//打包后调用fis-postpackager-your_postpackager插件进行处理</span>
        <span class="nx">postpackager</span> <span class="o">:</span> <span class="s1">&#39;your_postpackager&#39;</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>
<h3 id="toc_21">settings</h3>

<ul>
<li>解释：插件的运行配置节点。</li>
<li>值类型：<code>Object</code></li>
<li>默认值：无</li>
<li>说明：插件要工作，偶尔也需要配置数据，比如fis内置的<a href="https://github.com/fis-dev/fis-optimizer-uglify-js/blob/master/index.js#L12">fis-optimizer-uglify-js</a>、<a href="https://github.com/fis-dev/fis-optimizer-clean-css/blob/master/index.js#L11">fis-optimizer-clean-css</a>、<a href="https://github.com/fis-dev/fis-optimizer-html-minifier/blob/master/index.js#L11">fis-optimizer-html-minifier</a>插件，它们的配置都是fis直接传递的，具体细节可以查看相应源码。配置节点具有很强的规律性，请参考下面的例子，小编就不一一枚举了。</li>
<li>用法：</li>
</ul>
<div class="highlight"><pre><span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;settings.optimizer.uglify-js.output.max_line_len&#39;</span><span class="p">,</span> <span class="mi">500</span><span class="p">);</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;settings.optimizer.clean-css.keepBreaks&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
</pre></div><div class="highlight"><pre><span class="err">或者</span>
</pre></div><div class="highlight"><pre><span class="c1">//fis-conf.js</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">merge</span><span class="p">({</span>
    <span class="nx">settings</span> <span class="o">:</span> <span class="p">{</span>
        <span class="nx">optimizer</span> <span class="o">:</span> <span class="p">{</span>
            <span class="c1">//fis-optimizer-uglify-js插件的配置数据</span>
            <span class="s1">&#39;uglify-js&#39;</span> <span class="o">:</span> <span class="p">{</span>
                <span class="nx">output</span> <span class="o">:</span> <span class="p">{</span>
                    <span class="nx">max_line_len</span> <span class="o">:</span> <span class="mi">500</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="c1">//fis-optimizer-clean-css插件的配置数据</span>
            <span class="s1">&#39;clean-css&#39;</span> <span class="o">:</span> <span class="p">{</span>
                <span class="nx">keepBreaks</span> <span class="o">:</span> <span class="kc">true</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>
<h2 id="toc_22">内置插件运行配置</h2>

<h3 id="toc_23">settings.postprocessor.jswrapper</h3>

<ul>
<li>项目：<a href="https://github.com/fis-dev/fis-postprocessor-jswrapper">https://github.com/fis-dev/fis-postprocessor-jswrapper</a></li>
<li>解释：用于自动包装js代码的插件。</li>
<li>值类型：<code>Object</code></li>
<li>默认值：无</li>
<li>选项：

<ul>
<li><code>type</code>：包装方式。可选值目前只有 &#39;amd&#39;，amd包装结构请参考 <a href="https://github.com/fis-dev/fis-postprocessor-jswrapper/blob/master/index.js#L16">这里</a>，非amd包装结构参考 <a href="https://github.com/fis-dev/fis-postprocessor-jswrapper/blob/master/index.js#L20">这里</a></li>
<li>&quot;template&quot;：使用模板来定义包装结构，对template属性的设置优先级高于type属性。</li>
<li><code>wrapAll</code>：是否包装所有js文件。默认是false，只对标记为 <code>isMod</code> 的文件进行包装</li>
</ul></li>
<li>用法：</li>
</ul>
<div class="highlight"><pre><span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;settings.postprocessor.jswrapper.template&#39;</span><span class="p">,</span> <span class="s1">&#39;try{ ${content} }catch(e){e.message+=&quot;${id}&quot;;throw e;}&#39;</span><span class="p">);</span>
</pre></div><div class="highlight"><pre><span class="err">或者</span>
</pre></div><div class="highlight"><pre><span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">merge</span><span class="p">({</span>
    <span class="nx">settings</span> <span class="o">:</span> <span class="p">{</span>
        <span class="nx">postprocessor</span> <span class="o">:</span> <span class="p">{</span>
            <span class="nx">jswrapper</span> <span class="o">:</span> <span class="p">{</span>
                <span class="nx">template</span> <span class="o">:</span> <span class="s1">&#39;try{ ${content} }catch(e){ e.message += &quot;${id}&quot;; throw e; }&#39;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>
<h3 id="toc_24">settings.optimizer.uglify-js</h3>

<ul>
<li>项目：<a href="https://github.com/fis-dev/fis-optimizer-uglify-js">https://github.com/fis-dev/fis-optimizer-uglify-js</a></li>
<li>解释：uglify-js压缩器配置。fis-optimizer-uglify-js 插件内置了 <a href="https://github.com/mishoo/UglifyJS2">uglify-js</a> 包，并调用了它的 <a href="https://github.com/mishoo/UglifyJS2/blob/master/tools/node.js#L52">minify</a> 接口，把配置选项直接传递过去。因此，fis的配置完全等价于uglify-js的minify函数所需的配置</li>
<li>值类型：<code>Object</code></li>
<li>默认值：无</li>
<li>选项：

<ul>
<li><code>mangle</code>：混淆控制，参看uglify-js文档 <a href="http://lisperator.net/uglifyjs/mangle">mangle</a> 部分</li>
<li><code>output</code>：输出控制，参看uglify-js文档 <a href="http://lisperator.net/uglifyjs/codegen">codegen</a> 部分</li>
<li><code>compress</code>：优化参数，参看uglify-js文档 <a href="http://lisperator.net/uglifyjs/compress">compress</a> 部分</li>
</ul></li>
<li>用法：</li>
</ul>
<div class="highlight"><pre><span class="c1">//配置字符串全部转换为ascii字符</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;settings.optimizer.uglify-js.output.ascii_only&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
</pre></div><div class="highlight"><pre><span class="err">或者</span>
</pre></div><div class="highlight"><pre><span class="c1">//配置字符串全部转换为ascii字符</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">merge</span><span class="p">({</span>
    <span class="nx">settings</span> <span class="o">:</span> <span class="p">{</span>
        <span class="nx">optimizer</span> <span class="o">:</span> <span class="p">{</span>
            <span class="s1">&#39;uglify-js&#39;</span> <span class="o">:</span> <span class="p">{</span>
                <span class="nx">output</span> <span class="o">:</span> <span class="p">{</span>
                    <span class="nx">ascii_only</span> <span class="o">:</span> <span class="kc">true</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>
<h3 id="toc_25">settings.optimizer.clean-css</h3>

<ul>
<li>项目：<a href="https://github.com/fis-dev/fis-optimizer-clean-css">https://github.com/fis-dev/fis-optimizer-clean-css</a></li>
<li>解释：clean-css压缩器配置。fis-optimizer-clean-css 插件调用 <a href="https://github.com/GoalSmashers/clean-css">clean-css</a> 的压缩接口进行压缩，fis负责把 <code>settings.optimizer.clean-css</code> 配置节点的数据传递给压缩器，因此，这里的配置完全等价于clean-css的运行配置。</li>
<li>值类型：<code>Object</code></li>
<li>默认值：无</li>
<li>选项：参看clean-css的 <a href="https://github.com/GoalSmashers/clean-css#how-to-use-clean-css-programmatically">文档</a></li>
<li>用法：</li>
</ul>
<div class="highlight"><pre><span class="c1">//配置压缩css时保留换行</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;settings.optimizer.clean-css.keepBreaks&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
</pre></div>
<p>或者</p>
<div class="highlight"><pre><span class="c1">//配置压缩css时保留换行</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">merge</span><span class="p">({</span>
    <span class="nx">settings</span> <span class="o">:</span> <span class="p">{</span>
        <span class="nx">optimizer</span> <span class="o">:</span> <span class="p">{</span>
            <span class="s1">&#39;clean-css&#39;</span> <span class="o">:</span> <span class="p">{</span>
                <span class="nx">keepBreaks</span> <span class="o">:</span> <span class="kc">true</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>
<h3 id="toc_26">settings.optimizer.png-compressor</h3>

<ul>
<li>项目：<a href="https://github.com/fis-dev/fis-optimizer-png-compressor">https://github.com/fis-dev/fis-optimizer-png-compressor</a></li>
<li>解释：png图片压缩器运行配置。fis团队将 <code>pngquant</code> 和 <code>pngcrush</code> 两个优秀的png图片压缩工具移植为nodejs的原生扩展（<a href="https://github.com/xiangshouding/node-pngcrush">node-pngcrush</a>与<a href="https://github.com/xiangshouding/node-pngquant-native">node-pngquant-native</a>），相比同类型工具采用进程调用的方式更高性能，压缩速度更快。</li>
<li>值类型：<code>Object</code></li>
<li>默认值：无</li>
<li>选项：

<ul>
<li><code>type</code>：选择压缩器类型，默认是 &#39;pngcrush&#39;，可选值为 &#39;pngquant&#39;，pngquant会将所有 <code>png24</code> 的图片压缩为 <code>png8</code>，压缩率极高，但alpha通道信息会有损失。</li>
</ul></li>
<li>用法：</li>
</ul>
<div class="highlight"><pre><span class="c1">//使用pngquant进行压缩，png图片压缩后均为png8</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;settings.optimizer.png-compressor.type&#39;</span><span class="p">,</span> <span class="s1">&#39;quant&#39;</span><span class="p">);</span>
</pre></div>
<p>或者</p>
<div class="highlight"><pre><span class="c1">//使用pngquant进行压缩，png图片压缩后均为png8</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">merge</span><span class="p">({</span>
    <span class="nx">settings</span> <span class="o">:</span> <span class="p">{</span>
        <span class="nx">optimizer</span> <span class="o">:</span> <span class="p">{</span>
            <span class="s1">&#39;png-compressor&#39;</span> <span class="o">:</span> <span class="p">{</span>
                <span class="nx">type</span> <span class="o">:</span> <span class="s1">&#39;quant&#39;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>
<h3 id="toc_27">settings.spriter.csssprites</h3>

<ul>
<li>项目：<a href="https://github.com/fis-dev/fis-spriter-csssprites">https://github.com/fis-dev/fis-spriter-csssprites</a></li>
<li>解释：csssprite处理运行配置，以css文件为单位，对其引用的png、gif、jpg、jpeg等图片进行csssprite合并处理。<a href="https://github.com/zhangyuanwei">@zhangyuanwei</a> 同学将常用图片处理库的c++版本移植为nodejs的原生扩展，得到npm包 <a href="https://npmjs.org/package/node-images">node-images</a>，fis团队在此基础上进行包装，开发出了这款十分易用的csssprite插件。</li>
<li>值类型：<code>Object</code></li>
<li>默认值：</li>
</ul>
<div class="highlight"><pre><span class="p">{</span>
    <span class="nx">margin</span>       <span class="o">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="nx">layout</span>       <span class="o">:</span> <span class="s1">&#39;linear&#39;</span><span class="p">,</span>
    <span class="nx">width_limit</span>  <span class="o">:</span> <span class="mi">10240</span><span class="p">,</span>
    <span class="nx">height_limit</span> <span class="o">:</span> <span class="mi">10240</span>
<span class="p">}</span>
</pre></div>
<ul>
<li>选项：

<ul>
<li><code>margin</code>：图之间的边距，单位像素。</li>
<li><code>layout</code>：布局算法，默认是 &#39;linear&#39;，图片垂直布局，水平方向无需 <code>遮盖处理</code> 。可选项还有 <code>matrix</code>，图片矩阵布局，面积最小化，但需要提供额外的dom控制水平方向图片的遮盖处理</li>
</ul></li>
<li>注意：使用csssprite需要满足以下条件

<ol>
<li>使用release命令时，添加 <code>-p</code> 或者 <code>--pack</code> 参数。由于csssprite处理需要消耗一定的计算资源，并且开发过程中并不需要时刻做图片合并，因此fis将其定义为打包处理流程，启动csssprite处理需要指定--pack参数。</li>
<li>只有 <a href="https://github.com/fis-dev/fis/wiki/%E9%85%8D%E7%BD%AEAPI#pack">打包的css文件</a> 或者 <a href="https://github.com/fis-dev/fis/wiki/%E9%85%8D%E7%BD%AEAPI#roadmappath">roadmap.path</a> 中 <code>useSprite</code> 属性标记为 <code>true</code> 的文件才会进行csssprite处理，因此请合理安排要进行csssprite处理的文件，尽量对合并后的文件做处理。</li>
<li>在css中引用图片时，只要加上 <code>?__sprite</code> 这个query标记就可以使用csssprite了。详情请参考fis-spriter-csssprites插件的 <a href="https://github.com/fis-dev/fis-spriter-csssprites#%E4%BD%BF%E7%94%A8">使用文档</a>。</li>
</ol></li>
<li>用法：</li>
</ul>
<div class="highlight"><pre><span class="c1">//使用矩阵布局</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;settings.spriter.csssprites.layout&#39;</span><span class="p">,</span> <span class="s1">&#39;matrix&#39;</span><span class="p">);</span>
</pre></div>
<p>或者</p>
<div class="highlight"><pre><span class="c1">//使用矩阵布局</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">merge</span><span class="p">({</span>
    <span class="nx">settings</span> <span class="o">:</span> <span class="p">{</span>
        <span class="nx">spriter</span> <span class="o">:</span> <span class="p">{</span>
            <span class="nx">csssprites</span> <span class="o">:</span> <span class="p">{</span>
                <span class="nx">layout</span> <span class="o">:</span> <span class="s1">&#39;matrix&#39;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>
<h2 id="toc_28">目录规范与域名配置</h2>

<h3 id="toc_29">roadmap.path</h3>

<ul>
<li>解释：定制项目文件属性，包括但不限于 <strong>产出路径，访问url，资源id，默认依赖，文件类型</strong>。</li>
<li>值类型：<code>Array</code></li>
<li>默认值：无</li>
<li>说明：roadmap.path配置是fis编译系中非常核心的机制，使用它可以控制文件编译后发布的路径或访问的url、操纵文件属性、为fis产出的资源表添加扩展信息，它的 <a href="https://github.com/fouber/fis-kernel/blob/master/lib/uri.js#L45-L67">实现原理</a> 也很简单：当fis创建一个内部的 <a href="https://github.com/fouber/fis-kernel/blob/master/lib/file.js#L130">file对象</a> 时，会利用roadmap.path来匹配文件路径，如果命中，则将当前规则下的属性及其值赋给file对象，从而影响file对象的相关信息(发布路径、访问url、资源表属性等)。roadmap.path是fis系统中资源定位的核心能力，具有非常重要的意义。由于fis自动化工具接管了js、css和类html语言的 <strong>资源定位能力</strong>，因此，用户在开发时只需使用相对路径对资源进行引用，fis编译时会根据roadmap.path的配置调整引用内容，并将代码产出到配置指定的位置，一切都配合的非常完美！</li>
<li>支持的配置项：

<ul>
<li><code>reg</code>：用于匹配文件路径的正则(RegExp)或通配(String)。文件路径是相对项目根目录的路径，以 <code>/</code> 开头。</li>
<li><code>release</code>：设置文件的产出路径。默认是文件相对项目根目录的路径，以 <code>/</code> 开头。该值可以设置为 <code>false</code> ，表示为不产出（unreleasable）文件。</li>
<li><code>url</code>：指定文件的资源定位路径，以 <code>/</code> 开头。默认是 <code>release</code> 的值，url可以与发布路径 <code>release</code> 不一致。</li>
<li><code>query</code>：指定文件的资源定位路径之后的query，比如&#39;?t=123124132&#39;。</li>
<li><code>id</code>：指定文件的资源id。默认是 <code>namespace</code> + <code>subpath</code> 的值。</li>
<li><code>charset</code>：指定文本文件的输出编码。默认是 <code>utf8</code>，可以制定为 <code>gbk</code> 或 <code>gb2312</code>等。</li>
<li><code>isHtmlLike</code>：指定对文件进行html相关的 <a href="https://github.com/fis-dev/fis/wiki/%E4%B8%89%E7%A7%8D%E8%AF%AD%E8%A8%80%E8%83%BD%E5%8A%9B">语言能力扩展</a></li>
<li><code>isJsLike</code>：指定对文件进行js相关的 <a href="https://github.com/fis-dev/fis/wiki/%E4%B8%89%E7%A7%8D%E8%AF%AD%E8%A8%80%E8%83%BD%E5%8A%9B">语言能力扩展</a></li>
<li><code>isCssLike</code>：指定对文件进行css相关的 <a href="https://github.com/fis-dev/fis/wiki/%E4%B8%89%E7%A7%8D%E8%AF%AD%E8%A8%80%E8%83%BD%E5%8A%9B">语言能力扩展</a></li>
<li><code>useCompile</code>：指定文件是否经过fis的编译处理，如果为false，则该文件不会做任何编译处理。</li>
<li><code>useHash</code>：指定文件产出后是否添加md5戳。默认只有js、css、图片文件会添加。</li>
<li><code>useDomain</code>：指定文件引用处是否添加域名。</li>
<li><code>useCache</code>：指定文件编译过程中是否创建缓存，默认值是 <code>true</code>。</li>
<li><code>useMap</code>：指定fis在打包阶段是否将文件加入到map.json中索引。默认只有isJsLike、isCssLike、isMod的文件会加入表中</li>
<li><code>useParser</code>：指定文件是否经过parser插件处理。默认为true，值为 <code>false</code> 时才会关闭。</li>
<li><code>usePreprocessor</code>：指定文件是否经过preprocessor插件处理。默认为true，值为 <code>false</code> 时才会关闭。</li>
<li><code>useStandard</code>：指定文件是否经过内置的三种语言标准化流程处理。默认为true，值为 <code>false</code> 时才会关闭。</li>
<li><code>usePostprocessor</code>：指定文件是否经过postprocessor插件处理。默认为true，值为 <code>false</code> 时才会关闭。</li>
<li><code>useLint</code>：指定文件是否经过lint插件处理。默认为true，值为 <code>false</code> 时才会关闭。</li>
<li><code>useTest</code>：指定文件是否经过test插件处理。默认为true，值为 <code>false</code> 时才会关闭。</li>
<li><code>useOptimizer</code>：指定文件是否经过optimizer插件处理</li>
<li><code>useSprite</code>：指定文件是否进行csssprite处理。默认是 <code>false</code>，即不对单个文件进行csssprite操作的，而只对合并后的文件进行。fis release中使用 <code>--pack</code> 参数即可触发csssprite操作。</li>
<li><code>isMod</code>：标记文件为组件化文件。被标记成组件化的文件会入map.json表。并且会对js文件进行组件化包装。</li>
<li><code>extras</code>：在map.json中的附加数据，用于扩展map.json表的功能。</li>
<li><code>requires</code>：默认依赖的资源id表，类型为Array。</li>
</ul></li>
<li>用法：</li>
</ul>
<div class="highlight"><pre><span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">merge</span><span class="p">({</span>
    <span class="nx">roadmap</span> <span class="o">:</span> <span class="p">{</span>
        <span class="nx">path</span> <span class="o">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="c1">//所有widget目录下的js文件</span>
                <span class="nx">reg</span> <span class="o">:</span> <span class="s1">&#39;widget/**.js&#39;</span><span class="p">,</span>
                <span class="c1">//是模块化的js文件（标记为这种值的文件，会进行amd或者闭包包装）</span>
                <span class="nx">isMod</span> <span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
                <span class="c1">//默认依赖lib.js</span>
                <span class="nx">requires</span> <span class="o">:</span> <span class="p">[</span> <span class="s1">&#39;lib.js&#39;</span> <span class="p">],</span>
                <span class="c1">//向产出的map.json文件里附加一些信息</span>
                <span class="nx">extras</span> <span class="o">:</span> <span class="p">{</span> <span class="nx">say</span> <span class="o">:</span> <span class="s1">&#39;123&#39;</span> <span class="p">},</span>
                <span class="c1">//编译后产出到 /static/widget/xxx 目录下</span>
                <span class="nx">release</span> <span class="o">:</span> <span class="s1">&#39;/static$&amp;&#39;</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="c1">//所有的js文件</span>
                <span class="nx">reg</span> <span class="o">:</span> <span class="s1">&#39;**.js&#39;</span><span class="p">,</span>
                <span class="c1">//发布到/static/js/xxx目录下</span>
                <span class="nx">release</span> <span class="o">:</span> <span class="s1">&#39;/static/js$&amp;&#39;</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="c1">//所有的ico文件</span>
                <span class="nx">reg</span> <span class="o">:</span> <span class="s1">&#39;**.ico&#39;</span><span class="p">,</span>
                <span class="c1">//发布的时候即使加了--md5参数也不要生成带md5戳的文件</span>
                <span class="nx">useHash</span> <span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
                <span class="c1">//发布到/static/xxx目录下</span>
                <span class="nx">release</span> <span class="o">:</span> <span class="s1">&#39;/static$&amp;&#39;</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="c1">//所有image目录下的.png，.gif文件</span>
                <span class="nx">reg</span> <span class="o">:</span> <span class="sr">/^\/images\/(.*\.(?:png|gif))/i</span><span class="p">,</span>
                <span class="c1">//访问这些图片的url是 &#39;/m/xxxx?log_id=123&#39;</span>
                <span class="nx">url</span> <span class="o">:</span> <span class="s1">&#39;/m/$1?log_id=123&#39;</span><span class="p">,</span>
                <span class="c1">//发布到/static/pic/xxx目录下</span>
                <span class="nx">release</span> <span class="o">:</span> <span class="s1">&#39;/static/pic/$1&#39;</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="c1">//所有template目录下的.php文件</span>
                <span class="nx">reg</span> <span class="o">:</span> <span class="sr">/^\/template\/(.*\.php)/i</span><span class="p">,</span>
                <span class="c1">//是类html文件，会进行html语言能力扩展</span>
                <span class="nx">isHtmlLike</span> <span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
                <span class="c1">//发布为gbk编码文件</span>
                <span class="nx">charset</span> <span class="o">:</span> <span class="s1">&#39;gbk&#39;</span><span class="p">,</span>
                <span class="c1">//发布到/php/template/xxx目录下</span>
                <span class="nx">release</span> <span class="o">:</span> <span class="s1">&#39;/php/template/$1&#39;</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="c1">//前面规则未匹配到的其他文件</span>
                <span class="nx">reg</span> <span class="o">:</span> <span class="sr">/.*/</span><span class="p">,</span>
                <span class="c1">//编译的时候不要产出了</span>
                <span class="nx">release</span> <span class="o">:</span> <span class="kc">false</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>
<h3 id="toc_30">roadmap.ext</h3>

<ul>
<li>解释：指定后缀名与标准化语言的映射关系。</li>
<li>值类型：<code>Object</code></li>
<li>默认值：无</li>
<li>说明：fis允许在前端开发中使用less、coffee、utc等非标准语言，并能利用插件将它们编译成标准的js、css语言。这个过程是由modules.parser配置的插件处理的。编译之后，less会变成css文件，那么，后续对于css的处理应该同样可以适用于less的生成文件，因此，这个时候需要通过配置告诉fis，less文件会编译为css文件，并在后续的处理过程中当做css文件对待。</li>
<li>用法：</li>
</ul>
<div class="highlight"><pre><span class="c1">//fis-conf.js</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">merge</span><span class="p">({</span>
    <span class="nx">roadmap</span> <span class="o">:</span> <span class="p">{</span>
        <span class="nx">ext</span> <span class="o">:</span> <span class="p">{</span>
            <span class="c1">//less后缀的文件将输出为css后缀</span>
            <span class="c1">//并且在parser之后的其他处理流程中被当做css文件处理</span>
            <span class="nx">less</span> <span class="o">:</span> <span class="s1">&#39;css&#39;</span><span class="p">,</span>
            <span class="c1">//coffee后缀的文件将输出为js文件</span>
            <span class="c1">//并且在parser之后的其他处理流程中被当做js文件处理</span>
            <span class="nx">coffee</span> <span class="o">:</span> <span class="s1">&#39;js&#39;</span><span class="p">,</span>
            <span class="c1">//md后缀的文件将输出为html文件</span>
            <span class="c1">//并且在parser之后的其他处理流程中被当做html文件处理</span>
            <span class="nx">md</span> <span class="o">:</span> <span class="s1">&#39;html&#39;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>
<h3 id="toc_31">roadmap.domain</h3>

<ul>
<li>解释：设置静态资源的域名前缀。</li>
<li>值类型：<code>Object</code> | <code>string</code></li>
<li>默认值：无</li>
<li>说明：fis扩展了html、js、css的<a href="https://github.com/fis-dev/fis/wiki/%E4%B8%89%E7%A7%8D%E8%AF%AD%E8%A8%80%E8%83%BD%E5%8A%9B">三种语言能力</a>，并支持对资源的定位，定位包括 <strong>开发路径与发布路径的映射关系</strong> 以及 <strong>静态资源服务器域名设置</strong>。roadmap.domain节点就是用于控制该能力的配置。</li>
<li>注意：domain的值如果不是特殊需要，请 <strong>不要以&quot;/&quot;结尾</strong>。</li>
<li>用法：</li>
</ul>
<div class="highlight"><pre><span class="c1">//fis-conf.js</span>
<span class="c1">//用法一</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">merge</span><span class="p">({</span>
    <span class="nx">roadmap</span> <span class="o">:</span> <span class="p">{</span>
        <span class="c1">//所有静态资源文件都使用 http://s1.example.com 或者 http://s2.example.com 作为域名</span>
        <span class="nx">domain</span> <span class="o">:</span> <span class="s1">&#39;http://s1.example.com, http://s2.example.com&#39;</span>
    <span class="p">}</span>
<span class="p">});</span>
<span class="c1">//用法二</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">merge</span><span class="p">({</span>
    <span class="nx">roadmap</span> <span class="o">:</span> <span class="p">{</span>
        <span class="nx">domain</span> <span class="o">:</span> <span class="p">{</span>
            <span class="c1">//widget目录下的所有css文件使用 http://css1.example.com 作为域名</span>
            <span class="s1">&#39;widget/**.css&#39;</span> <span class="o">:</span> <span class="s1">&#39;http://css1.example.com&#39;</span><span class="p">,</span>
            <span class="c1">//所有的js文件使用 http://js1.example.com 或者  http://js2.example.com 作为域名</span>
            <span class="s1">&#39;**.js&#39;</span> <span class="o">:</span> <span class="p">[</span><span class="s1">&#39;http://js1.example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;http://js2.example.com&#39;</span><span class="p">]</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>
<p>编译时使用fis release的 <code>--domains</code> 参数来控制是否添加domain</p>
<div class="highlight"><pre><span class="nv">$ </span>fis release --domains --dest ../output
</pre></div>
<h3 id="toc_32">roadmap.domain.image</h3>

<ul>
<li>解释：设置图片资源的域名前缀。</li>
<li>值类型：<code>Array</code> | <code>string</code></li>
<li>默认值：无</li>
<li>说明：由于使用配置roadmap.domain.ext方式来配置图片资源太麻烦，fis提供了image字段，对于符合 <a href="https://github.com/fis-dev/fis/wiki/%E9%85%8D%E7%BD%AEAPI#projectfiletypeimage">project.fileType.image</a> 规则的文件，设置相应domain配置。</li>
<li>用法：</li>
</ul>
<div class="highlight"><pre><span class="c1">//fis-conf.js</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">merge</span><span class="p">({</span>
    <span class="nx">roadmap</span> <span class="o">:</span> <span class="p">{</span>
        <span class="nx">domain</span> <span class="o">:</span> <span class="p">{</span>
            <span class="c1">//所有图片文件，使用 http://img.example.com 作为域名</span>
            <span class="s1">&#39;image&#39;</span> <span class="o">:</span> <span class="p">[</span><span class="s1">&#39;http://img.example.com&#39;</span><span class="p">]</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>
<p>编译时使用fis release的 <code>--domains</code> 参数来控制是否添加domain</p>
<div class="highlight"><pre><span class="nv">$ </span>fis release --domains --dest ../output
</pre></div>
<h2 id="toc_33">部署配置</h2>

<h3 id="toc_34">deploy</h3>

<ul>
<li>解释：设置项目的发布方式。</li>
<li>值类型：<code>Object</code></li>
<li>默认值：无</li>
<li>说明：当使用 fis release 命令时，参数 <strong>--dest &lt;name&gt;</strong> 可以指定项目发布配置。deploy配置是一个key-value的object对象，--dest参数的值如果与配置的key相同，则执行该配置的部署设置。fis支持使用post请求向http服务器发送文件，服务器端可以使用php、java等后端逻辑进行接收，<a href="https://github.com/fis-dev/fis-command-release">fis-command-release</a>插件中提供了一个这样的 <a href="https://github.com/fis-dev/fis-command-release/blob/master/tools/receiver.php">php版示例</a>，用户可以直接部署此文件于接收端服务器上。</li>
<li>用法：</li>
</ul>
<div class="highlight"><pre><span class="c1">//fis-conf.js</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">merge</span><span class="p">({</span>
    <span class="nx">deploy</span> <span class="o">:</span> <span class="p">{</span>
        <span class="c1">//使用fis release --dest remote来使用这个配置</span>
        <span class="nx">remote</span> <span class="o">:</span> <span class="p">{</span>
            <span class="c1">//如果配置了receiver，fis会把文件逐个post到接收端上</span>
            <span class="nx">receiver</span> <span class="o">:</span> <span class="s1">&#39;http://www.example.com/path/to/receiver.php&#39;</span><span class="p">,</span>
            <span class="c1">//从产出的结果的static目录下找文件</span>
            <span class="nx">from</span> <span class="o">:</span> <span class="s1">&#39;/static&#39;</span><span class="p">,</span>
            <span class="c1">//保存到远端机器的/home/fis/www/static目录下</span>
            <span class="c1">//这个参数会跟随post请求一起发送</span>
            <span class="nx">to</span> <span class="o">:</span> <span class="s1">&#39;/home/fis/www/&#39;</span><span class="p">,</span>
            <span class="c1">//通配或正则过滤文件，表示只上传所有的js文件</span>
            <span class="nx">include</span> <span class="o">:</span> <span class="s1">&#39;**.js&#39;</span><span class="p">,</span>
            <span class="c1">//widget目录下的那些文件就不要发布了</span>
            <span class="nx">exclude</span> <span class="o">:</span> <span class="sr">/\/widget\//i</span><span class="p">,</span>
            <span class="c1">//支持对文件进行字符串替换</span>
            <span class="nx">replace</span> <span class="o">:</span> <span class="p">{</span>
                <span class="nx">from</span> <span class="o">:</span> <span class="s1">&#39;http://www.online.com&#39;</span><span class="p">,</span>
                <span class="nx">to</span> <span class="o">:</span> <span class="s1">&#39;http://www.offline.com&#39;</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="c1">//名字随便取的，没有特殊含义</span>
        <span class="nx">local</span> <span class="o">:</span> <span class="p">{</span>
            <span class="c1">//from参数省略，表示从发布后的根目录开始上传</span>
            <span class="c1">//发布到当前项目的上一级的output目录中</span>
            <span class="nx">to</span> <span class="o">:</span> <span class="s1">&#39;../output&#39;</span><span class="p">,</span>
            <span class="c1">//可以通过正则的方式实现多个字符串的替换</span>
            <span class="nx">replace</span> <span class="o">:</span> <span class="p">{</span>
                <span class="nx">from</span> <span class="o">:</span> <span class="sr">/www\.a\.com|www\.b\.com/</span><span class="p">,</span>
                <span class="nx">to</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">m</span><span class="p">){</span>
                    <span class="k">if</span><span class="p">(</span><span class="nx">m</span> <span class="o">===</span> <span class="s1">&#39;www.a.com&#39;</span><span class="p">)</span> <span class="k">return</span> <span class="s1">&#39;www.x.com&#39;</span><span class="p">;</span>
                    <span class="k">if</span><span class="p">(</span><span class="nx">m</span> <span class="o">===</span> <span class="s1">&#39;www.b.com&#39;</span><span class="p">)</span> <span class="k">return</span> <span class="s1">&#39;www.y.com&#39;</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="c1">//也可以是一个数组</span>
        <span class="nx">remote2</span> <span class="o">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="c1">//将static目录上传到/home/fis/www/webroot下</span>
                <span class="c1">//上传文件路径为/home/fis/www/webroot/static/xxxx</span>
                <span class="nx">receiver</span> <span class="o">:</span> <span class="s1">&#39;http://www.example.com/path/to/receiver.php&#39;</span><span class="p">,</span>
                <span class="nx">from</span> <span class="o">:</span> <span class="s1">&#39;/static&#39;</span><span class="p">,</span>
                <span class="nx">to</span> <span class="o">:</span> <span class="s1">&#39;/home/fis/www/webroot&#39;</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="c1">//将template目录内的文件（不包括template一级）</span>
                <span class="c1">//上传到/home/fis/www/tpl下</span>
                <span class="c1">//上传文件路径为/home/fis/www/tpl/xxxx</span>
                <span class="nx">receiver</span> <span class="o">:</span> <span class="s1">&#39;http://www.example.com/path/to/receiver.php&#39;</span><span class="p">,</span>
                <span class="nx">from</span> <span class="o">:</span> <span class="s1">&#39;/template&#39;</span><span class="p">,</span>
                <span class="nx">to</span> <span class="o">:</span> <span class="s1">&#39;/home/fis/www/tpl&#39;</span><span class="p">,</span>
                <span class="nx">subOnly</span> <span class="o">:</span> <span class="kc">true</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>
<ul>
<li>小贴士：--dest参数支持使用逗号（,）分割多个发布配置，比如上面的例子，我们可以使用fis release --dest <strong>remote,local,remote2</strong> 命令在一次编译中同时发布多个目标。</li>
</ul>

<h2 id="toc_35">打包配置</h2>

<h3 id="toc_36">pack</h3>

<ul>
<li>解释：配置要打包合并的文件。</li>
<li>值类型：<code>Object</code></li>
<li>默认值：无</li>
<li>说明：fis内置的 <a href="https://github.com/fis-dev/fis/wiki/%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86#----1">打包策略</a> 与传统的打包概念不同，fis的打包实际上是在建立一个资源表，并将其描述并产出为一份map.json文件，用户应该围绕着这份描述文件来设计前后端运行框架，从而实现运行时判断打包输出策略的架构。</li>
<li>用法：</li>
</ul>
<div class="highlight"><pre><span class="c1">//fis-conf.js</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">merge</span><span class="p">({</span>
    <span class="nx">pack</span> <span class="o">:</span> <span class="p">{</span>
        <span class="c1">//打包所有的demo.js, script.js文件</span>
        <span class="c1">//将内容输出为static/pkg/aio.js文件</span>
        <span class="s1">&#39;pkg/aio.js&#39;</span> <span class="o">:</span> <span class="p">[</span><span class="s1">&#39;**/demo.js&#39;</span><span class="p">,</span> <span class="sr">/\/script\.js$/i</span><span class="p">],</span>
        <span class="c1">//打包所有的css文件</span>
        <span class="c1">//将内容输出为static/pkg/aio.css文件</span>
        <span class="s1">&#39;pkg/aio.css&#39;</span> <span class="o">:</span> <span class="s1">&#39;**.css&#39;</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>
<ul>
<li>输出结果：使用命令 fis release <strong>--pack</strong> --md5 --dest ./output 编译项目，然后到output目录下查看产出的map.json内容得到：</li>
</ul>
<div class="highlight"><pre><span class="p">{</span>
    <span class="nt">&quot;res&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;demo.css&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;uri&quot;</span><span class="p">:</span> <span class="s2">&quot;/static/css/demo_7defa41.css&quot;</span><span class="p">,</span>
            <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;css&quot;</span><span class="p">,</span>
            <span class="nt">&quot;pkg&quot;</span><span class="p">:</span> <span class="s2">&quot;p1&quot;</span>
        <span class="p">},</span>
        <span class="nt">&quot;demo.js&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;uri&quot;</span><span class="p">:</span> <span class="s2">&quot;/static/js/demo_33c5143.js&quot;</span><span class="p">,</span>
            <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;js&quot;</span><span class="p">,</span>
            <span class="nt">&quot;deps&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&quot;demo.css&quot;</span>
            <span class="p">],</span>
            <span class="nt">&quot;pkg&quot;</span><span class="p">:</span> <span class="s2">&quot;p0&quot;</span>
        <span class="p">},</span>
        <span class="nt">&quot;index.html&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;uri&quot;</span><span class="p">:</span> <span class="s2">&quot;/index.html&quot;</span><span class="p">,</span>
            <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;html&quot;</span><span class="p">,</span>
            <span class="nt">&quot;deps&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&quot;demo.js&quot;</span><span class="p">,</span>
                <span class="s2">&quot;demo.css&quot;</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="nt">&quot;script.js&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;uri&quot;</span><span class="p">:</span> <span class="s2">&quot;/static/js/script_32300bf.js&quot;</span><span class="p">,</span>
            <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;js&quot;</span><span class="p">,</span>
            <span class="nt">&quot;pkg&quot;</span><span class="p">:</span> <span class="s2">&quot;p0&quot;</span>
        <span class="p">},</span>
        <span class="nt">&quot;style.css&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;uri&quot;</span><span class="p">:</span> <span class="s2">&quot;/static/css/style_837b297.css&quot;</span><span class="p">,</span>
            <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;css&quot;</span><span class="p">,</span>
            <span class="nt">&quot;pkg&quot;</span><span class="p">:</span> <span class="s2">&quot;p1&quot;</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="nt">&quot;pkg&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;p0&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;uri&quot;</span><span class="p">:</span> <span class="s2">&quot;/static/pkg/aio_5bb04ef.js&quot;</span><span class="p">,</span>
            <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;js&quot;</span><span class="p">,</span>
            <span class="nt">&quot;has&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&quot;demo.js&quot;</span><span class="p">,</span>
                <span class="s2">&quot;script.js&quot;</span>
            <span class="p">],</span>
            <span class="nt">&quot;deps&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&quot;demo.css&quot;</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="nt">&quot;p1&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;uri&quot;</span><span class="p">:</span> <span class="s2">&quot;/static/pkg/aio_cdf8bd3.css&quot;</span><span class="p">,</span>
            <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;css&quot;</span><span class="p">,</span>
            <span class="nt">&quot;has&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&quot;demo.css&quot;</span><span class="p">,</span>
                <span class="s2">&quot;style.css&quot;</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>